server {
    listen 8080;
    server_name _;
    server_tokens off;

    root /usr/share/nginx/html;

    error_page 404 /404.html;

    # Next.js static export - handle dynamic routes
    location ~* ^/mailbox/[^/]+$ {
        try_files /mailbox/[mailboxId].html =404;
    }
    location ~* ^/mailbox/[^/]+/thread/[^/]+$ {
        try_files /mailbox/[mailboxId]/thread/[threadId].html =404;
    }
    location ~* ^/mailbox/[^/]+/new$ {
        try_files /mailbox/[mailboxId]/new.html =404;
    }
    location ~* ^/domain$ {
        try_files /domain.html =404;
    }
    location ~* ^/domain/[^/]+$ {
        try_files /domain/[maildomainId].html =404;
    }
    location ~* ^/domain/[^/]+/dns$ {
        try_files /domain/[maildomainId]/dns.html =404;
    }
    location ~* ^/domain/[^/]+/signatures$ {
        try_files /domain/[maildomainId]/signatures.html =404;
    }

    location = /404.html {
        internal;
    }

    # Frontend static export
    location / {
        try_files $uri $uri/ /index.html =404;
    }
}
